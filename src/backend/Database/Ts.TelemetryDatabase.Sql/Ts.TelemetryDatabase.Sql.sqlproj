<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="4.0">
  <!-- Enable to build in VisualStudio 2026 -->
  <!--Sdk Name="Microsoft.Build.Sql" Version="1.0.0" /-->
  <!-- Enable to build via sdk (pipelines), dotnet build  -->
  <Sdk Name="Microsoft.Build.Sql" Version="2.0.0" />
  <PropertyGroup>
    <SqlTargetName>Ts.TelemetryDatabase.Sql</SqlTargetName>
    <DSP>Microsoft.Data.Tools.Schema.Sql.Sql170DatabaseSchemaProvider</DSP>
    <ModelCollation>1033, CI</ModelCollation>
    <TargetDatabaseSet>True</TargetDatabaseSet>
    <ProjectGuid>{718690b9-8e19-0b53-d189-44507ab89f16}</ProjectGuid>
    <RunSqlCodeAnalysis>True</RunSqlCodeAnalysis>
    <DefaultFileStructure>BySchemaType</DefaultFileStructure>
    <!-- EnableDefaultSqlItems is needed until VS have full support for the new sdk style projects -->
    <EnableDefaultSqlItems>False</EnableDefaultSqlItems>
  </PropertyGroup>
  <Target Name="PreBuild" BeforeTargets="PreBuildEvent" Condition="'$(MSBuildRuntimeType)' != 'Core'">
    <!-- 
        Building through visual studio (targeting net48) will fail if a previous build through the dotnet core cli
        has run and created the obj/project.assets.json file. This custom target should delete the file before the visual studio build starts.
      -->
    <Message Importance="high" Text="Ensuring the $(MSBuildThisFileDirectory)\obj\project.assets.json file is removed, if necessary, so that the database project can be built through VisualStudio SSDT without errors" />
    <Delete Files="$(MSBuildThisFileDirectory)\obj\project.assets.json" />
  </Target>
  <ItemGroup>
    <Folder Include="User Defined Types\" />
    <Folder Include="Stored Procedures\" />
    <Folder Include="Tables\" />
    <Folder Include="Security\" />
  </ItemGroup>
  <ItemGroup>
    <Build Remove="bin/**/*.sql" />
    <Build Remove="obj/**/*.sql" />
    <Build Include="User Defined Types\TelemetriesType.sql" />
    <Build Include="Tables\Devices.sql" />
    <Build Include="Tables\Registers.sql" />
    <Build Include="Tables\Telemetries.sql" />
    <Build Include="Tables\Timestamps.sql" />
    <Build Include="Security\db_execute_procedure_role.sql" />
    <Build Include="Security\create_user.sql" />
    <Build Include="User Defined Types\RegistersType.sql" />
    <Build Include="Stored Procedures\GetTelemetryValues.sql" />
    <Build Include="Stored Procedures\UpsertTelemetry.sql" />
    <Build Include="Stored Procedures\GetOrCreateRegisters.sql" />
    <Build Include="Stored Procedures\UpsertDevice.sql" />
    <Build Include="Stored Procedures\HealthCheck.sql" />
  </ItemGroup>
  <ItemGroup>
    <None Include="Directory.Build.props" />
  </ItemGroup>
</Project>